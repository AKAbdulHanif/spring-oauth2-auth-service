<svg width="1400" height="1000" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-family: Arial, sans-serif; font-size: 24px; font-weight: bold; fill: #2c3e50; }
      .subtitle { font-family: Arial, sans-serif; font-size: 16px; fill: #7f8c8d; }
      .component { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; fill: white; }
      .description { font-family: Arial, sans-serif; font-size: 11px; fill: white; }
      .layer-title { font-family: Arial, sans-serif; font-size: 16px; font-weight: bold; fill: #2c3e50; }
      .controller { fill: #e74c3c; stroke: #c0392b; stroke-width: 2; }
      .service { fill: #3498db; stroke: #2980b9; stroke-width: 2; }
      .repository { fill: #f39c12; stroke: #e67e22; stroke-width: 2; }
      .entity { fill: #9b59b6; stroke: #8e44ad; stroke-width: 2; }
      .config { fill: #27ae60; stroke: #229954; stroke-width: 2; }
      .external { fill: #95a5a6; stroke: #7f8c8d; stroke-width: 2; }
      .flow-arrow { stroke: #34495e; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .dependency-arrow { stroke: #7f8c8d; stroke-width: 1; stroke-dasharray: 5,5; fill: none; marker-end: url(#arrowhead-small); }
      .flow-label { font-family: Arial, sans-serif; font-size: 10px; fill: #2c3e50; }
      .layer-bg { fill: #ecf0f1; stroke: #bdc3c7; stroke-width: 1; opacity: 0.3; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#34495e" />
    </marker>
    <marker id="arrowhead-small" markerWidth="8" markerHeight="5" refX="7" refY="2.5" orient="auto">
      <polygon points="0 0, 8 2.5, 0 5" fill="#7f8c8d" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="700" y="30" text-anchor="middle" class="title">OAuth2 Authorization Service - Component Architecture</text>
  <text x="700" y="55" text-anchor="middle" class="subtitle">Detailed internal component structure and dependencies</text>
  
  <!-- Layer Backgrounds -->
  <rect x="50" y="100" width="1300" height="120" rx="5" class="layer-bg"/>
  <rect x="50" y="240" width="1300" height="200" rx="5" class="layer-bg"/>
  <rect x="50" y="460" width="1300" height="120" rx="5" class="layer-bg"/>
  <rect x="50" y="600" width="1300" height="120" rx="5" class="layer-bg"/>
  <rect x="50" y="740" width="1300" height="120" rx="5" class="layer-bg"/>
  
  <!-- Layer Labels -->
  <text x="70" y="125" class="layer-title">Presentation Layer (Controllers)</text>
  <text x="70" y="265" class="layer-title">Business Logic Layer (Services)</text>
  <text x="70" y="485" class="layer-title">Data Access Layer (Repositories)</text>
  <text x="70" y="625" class="layer-title">Data Model Layer (Entities)</text>
  <text x="70" y="765" class="layer-title">Configuration Layer</text>
  
  <!-- Presentation Layer -->
  <g id="controllers">
    <!-- OAuth2Controller -->
    <rect x="100" y="140" width="200" height="60" rx="5" class="controller"/>
    <text x="200" y="160" text-anchor="middle" class="component">OAuth2Controller</text>
    <text x="200" y="175" text-anchor="middle" class="description">• /oauth2/token</text>
    <text x="200" y="185" text-anchor="middle" class="description">• /oauth2/introspect</text>
    <text x="200" y="195" text-anchor="middle" class="description">• /.well-known/*</text>
    
    <!-- ClientRegistrationController -->
    <rect x="350" y="140" width="200" height="60" rx="5" class="controller"/>
    <text x="450" y="160" text-anchor="middle" class="component">ClientRegistrationController</text>
    <text x="450" y="175" text-anchor="middle" class="description">• POST /api/v1/clients</text>
    <text x="450" y="185" text-anchor="middle" class="description">• GET /api/v1/clients</text>
    <text x="450" y="195" text-anchor="middle" class="description">• PUT/DELETE clients</text>
    
    <!-- DiscoveryController -->
    <rect x="600" y="140" width="200" height="60" rx="5" class="controller"/>
    <text x="700" y="160" text-anchor="middle" class="component">DiscoveryController</text>
    <text x="700" y="175" text-anchor="middle" class="description">• OIDC Discovery</text>
    <text x="700" y="185" text-anchor="middle" class="description">• JWKS Endpoint</text>
    <text x="700" y="195" text-anchor="middle" class="description">• Metadata</text>
  </g>
  
  <!-- Business Logic Layer -->
  <g id="services">
    <!-- OAuth2Service -->
    <rect x="100" y="280" width="180" height="80" rx="5" class="service"/>
    <text x="190" y="300" text-anchor="middle" class="component">OAuth2Service</text>
    <text x="190" y="315" text-anchor="middle" class="description">• Client Credentials Flow</text>
    <text x="190" y="325" text-anchor="middle" class="description">• Token Generation</text>
    <text x="190" y="335" text-anchor="middle" class="description">• Client Validation</text>
    <text x="190" y="345" text-anchor="middle" class="description">• Scope Management</text>
    <text x="190" y="355" text-anchor="middle" class="description">• Multi-tenant Support</text>
    
    <!-- JwtService -->
    <rect x="300" y="280" width="180" height="80" rx="5" class="service"/>
    <text x="390" y="300" text-anchor="middle" class="component">JwtService</text>
    <text x="390" y="315" text-anchor="middle" class="description">• JWT Generation</text>
    <text x="390" y="325" text-anchor="middle" class="description">• Token Validation</text>
    <text x="390" y="335" text-anchor="middle" class="description">• Claims Management</text>
    <text x="390" y="345" text-anchor="middle" class="description">• HMAC-SHA256 Signing</text>
    <text x="390" y="355" text-anchor="middle" class="description">• Key Management</text>
    
    <!-- ClientRegistrationService -->
    <rect x="500" y="280" width="180" height="80" rx="5" class="service"/>
    <text x="590" y="300" text-anchor="middle" class="component">ClientRegistrationService</text>
    <text x="590" y="315" text-anchor="middle" class="description">• Client Registration</text>
    <text x="590" y="325" text-anchor="middle" class="description">• Lifecycle Management</text>
    <text x="590" y="335" text-anchor="middle" class="description">• Validation Logic</text>
    <text x="590" y="345" text-anchor="middle" class="description">• Status Management</text>
    <text x="590" y="355" text-anchor="middle" class="description">• Tenant Assignment</text>
    
    <!-- TokenIntrospectionService -->
    <rect x="700" y="280" width="180" height="80" rx="5" class="service"/>
    <text x="790" y="300" text-anchor="middle" class="component">TokenIntrospectionService</text>
    <text x="790" y="315" text-anchor="middle" class="description">• Token Validation</text>
    <text x="790" y="325" text-anchor="middle" class="description">• Claims Extraction</text>
    <text x="790" y="335" text-anchor="middle" class="description">• Expiry Checking</text>
    <text x="790" y="345" text-anchor="middle" class="description">• Signature Verification</text>
    <text x="790" y="355" text-anchor="middle" class="description">• Metadata Response</text>
    
    <!-- DiscoveryService -->
    <rect x="900" y="280" width="180" height="80" rx="5" class="service"/>
    <text x="990" y="300" text-anchor="middle" class="component">DiscoveryService</text>
    <text x="990" y="315" text-anchor="middle" class="description">• OIDC Metadata</text>
    <text x="990" y="325" text-anchor="middle" class="description">• JWKS Generation</text>
    <text x="990" y="335" text-anchor="middle" class="description">• Endpoint Discovery</text>
    <text x="990" y="345" text-anchor="middle" class="description">• Configuration</text>
    <text x="990" y="355" text-anchor="middle" class="description">• Standards Compliance</text>
    
    <!-- TenantService -->
    <rect x="1100" y="280" width="180" height="80" rx="5" class="service"/>
    <text x="1190" y="300" text-anchor="middle" class="component">TenantService</text>
    <text x="1190" y="315" text-anchor="middle" class="description">• Tenant Management</text>
    <text x="1190" y="325" text-anchor="middle" class="description">• Isolation Logic</text>
    <text x="1190" y="335" text-anchor="middle" class="description">• Scope Validation</text>
    <text x="1190" y="345" text-anchor="middle" class="description">• Access Control</text>
    <text x="1190" y="355" text-anchor="middle" class="description">• Cross-tenant Prevention</text>
  </g>
  
  <!-- Data Access Layer -->
  <g id="repositories">
    <!-- OAuth2ClientRepository -->
    <rect x="300" y="480" width="200" height="60" rx="5" class="repository"/>
    <text x="400" y="500" text-anchor="middle" class="component">OAuth2ClientRepository</text>
    <text x="400" y="515" text-anchor="middle" class="description">• findByClientId()</text>
    <text x="400" y="525" text-anchor="middle" class="description">• findByTenantId()</text>
    <text x="400" y="535" text-anchor="middle" class="description">• save(), delete(), findAll()</text>
    
    <!-- Custom Repository Methods -->
    <rect x="550" y="480" width="200" height="60" rx="5" class="repository"/>
    <text x="650" y="500" text-anchor="middle" class="component">ClientRepositoryCustom</text>
    <text x="650" y="515" text-anchor="middle" class="description">• findActiveClients()</text>
    <text x="650" y="525" text-anchor="middle" class="description">• updateLastUsedAt()</text>
    <text x="650" y="535" text-anchor="middle" class="description">• findByTenantAndScope()</text>
  </g>
  
  <!-- Data Model Layer -->
  <g id="entities">
    <!-- OAuth2Client Entity -->
    <rect x="200" y="640" width="200" height="60" rx="5" class="entity"/>
    <text x="300" y="660" text-anchor="middle" class="component">OAuth2Client</text>
    <text x="300" y="675" text-anchor="middle" class="description">• id, clientId, clientSecret</text>
    <text x="300" y="685" text-anchor="middle" class="description">• tenantId, scopes, status</text>
    <text x="300" y="695" text-anchor="middle" class="description">• createdAt, lastUsedAt</text>
    
    <!-- DTOs -->
    <rect x="450" y="640" width="200" height="60" rx="5" class="entity"/>
    <text x="550" y="660" text-anchor="middle" class="component">DTOs</text>
    <text x="550" y="675" text-anchor="middle" class="description">• ClientRegistrationRequest</text>
    <text x="550" y="685" text-anchor="middle" class="description">• TokenResponse</text>
    <text x="550" y="695" text-anchor="middle" class="description">• IntrospectionResponse</text>
    
    <!-- Enums -->
    <rect x="700" y="640" width="200" height="60" rx="5" class="entity"/>
    <text x="800" y="660" text-anchor="middle" class="component">Enums</text>
    <text x="800" y="675" text-anchor="middle" class="description">• ClientStatus</text>
    <text x="800" y="685" text-anchor="middle" class="description">• GrantType</text>
    <text x="800" y="695" text-anchor="middle" class="description">• TokenType</text>
  </g>
  
  <!-- Configuration Layer -->
  <g id="configuration">
    <!-- SecurityConfig -->
    <rect x="100" y="760" width="180" height="60" rx="5" class="config"/>
    <text x="190" y="780" text-anchor="middle" class="component">SecurityConfig</text>
    <text x="190" y="795" text-anchor="middle" class="description">• Spring Security Setup</text>
    <text x="190" y="805" text-anchor="middle" class="description">• BCrypt Password Encoder</text>
    <text x="190" y="815" text-anchor="middle" class="description">• CSRF Disabled</text>
    
    <!-- JwtConfig -->
    <rect x="300" y="760" width="180" height="60" rx="5" class="config"/>
    <text x="390" y="780" text-anchor="middle" class="component">JwtConfig</text>
    <text x="390" y="795" text-anchor="middle" class="description">• JWT Secret Key</text>
    <text x="390" y="805" text-anchor="middle" class="description">• Token Expiration</text>
    <text x="390" y="815" text-anchor="middle" class="description">• Issuer Configuration</text>
    
    <!-- DatabaseConfig -->
    <rect x="500" y="760" width="180" height="60" rx="5" class="config"/>
    <text x="590" y="780" text-anchor="middle" class="component">DatabaseConfig</text>
    <text x="590" y="795" text-anchor="middle" class="description">• JPA Configuration</text>
    <text x="590" y="805" text-anchor="middle" class="description">• H2/PostgreSQL Setup</text>
    <text x="590" y="815" text-anchor="middle" class="description">• Connection Pooling</text>
    
    <!-- ApplicationConfig -->
    <rect x="700" y="760" width="180" height="60" rx="5" class="config"/>
    <text x="790" y="780" text-anchor="middle" class="component">ApplicationConfig</text>
    <text x="790" y="795" text-anchor="middle" class="description">• Bean Definitions</text>
    <text x="790" y="805" text-anchor="middle" class="description">• Component Scanning</text>
    <text x="790" y="815" text-anchor="middle" class="description">• Profile Configuration</text>
    
    <!-- ActuatorConfig -->
    <rect x="900" y="760" width="180" height="60" rx="5" class="config"/>
    <text x="990" y="780" text-anchor="middle" class="component">ActuatorConfig</text>
    <text x="990" y="795" text-anchor="middle" class="description">• Health Checks</text>
    <text x="990" y="805" text-anchor="middle" class="description">• Metrics Exposure</text>
    <text x="990" y="815" text-anchor="middle" class="description">• Management Endpoints</text>
  </g>
  
  <!-- External Dependencies -->
  <g id="external">
    <rect x="1150" y="140" width="180" height="60" rx="5" class="external"/>
    <text x="1240" y="160" text-anchor="middle" class="component">External Libraries</text>
    <text x="1240" y="175" text-anchor="middle" class="description">• Spring Boot</text>
    <text x="1240" y="185" text-anchor="middle" class="description">• Spring Security</text>
    <text x="1240" y="195" text-anchor="middle" class="description">• JJWT, BCrypt</text>
  </g>
  
  <!-- Dependencies and Flows -->
  <g id="dependencies">
    <!-- Controller to Service dependencies -->
    <path d="M 200 200 L 190 280" class="dependency-arrow"/>
    <path d="M 450 200 L 590 280" class="dependency-arrow"/>
    <path d="M 700 200 L 990 280" class="dependency-arrow"/>
    
    <!-- Service to Service dependencies -->
    <path d="M 280 320 L 300 320" class="dependency-arrow"/>
    <path d="M 480 320 L 500 320" class="dependency-arrow"/>
    <path d="M 680 320 L 700 320" class="dependency-arrow"/>
    
    <!-- Service to Repository dependencies -->
    <path d="M 190 360 L 400 480" class="dependency-arrow"/>
    <path d="M 590 360 L 400 480" class="dependency-arrow"/>
    <path d="M 590 360 L 650 480" class="dependency-arrow"/>
    
    <!-- Repository to Entity dependencies -->
    <path d="M 400 540 L 300 640" class="dependency-arrow"/>
    <path d="M 650 540 L 300 640" class="dependency-arrow"/>
    
    <!-- Configuration dependencies -->
    <path d="M 190 760 L 190 360" class="dependency-arrow"/>
    <path d="M 390 760 L 390 360" class="dependency-arrow"/>
    <path d="M 590 760 L 400 540" class="dependency-arrow"/>
  </g>
  
  <!-- Data Flow Arrows -->
  <g id="flows">
    <!-- Main OAuth2 Flow -->
    <path d="M 200 140 Q 200 100 190 280" class="flow-arrow"/>
    <text x="150" y="120" class="flow-label">Token Request</text>
    
    <path d="M 280 320 Q 350 250 390 280" class="flow-arrow"/>
    <text x="320" y="240" class="flow-label">Generate JWT</text>
    
    <path d="M 190 360 Q 250 420 400 480" class="flow-arrow"/>
    <text x="280" y="440" class="flow-label">Validate Client</text>
    
    <!-- Client Registration Flow -->
    <path d="M 450 140 Q 450 100 590 280" class="flow-arrow"/>
    <text x="480" y="120" class="flow-label">Register Client</text>
    
    <path d="M 590 360 Q 550 420 400 480" class="flow-arrow"/>
    <text x="520" y="440" class="flow-label">Store Client</text>
  </g>
  
  <!-- Legend -->
  <g id="legend">
    <rect x="50" y="880" width="400" height="100" rx="5" fill="#ecf0f1" stroke="#bdc3c7" stroke-width="1"/>
    <text x="250" y="900" text-anchor="middle" class="component" style="fill: #2c3e50;">Component Legend</text>
    
    <rect x="70" y="910" width="15" height="10" class="controller"/>
    <text x="95" y="920" class="flow-label">Controllers</text>
    
    <rect x="170" y="910" width="15" height="10" class="service"/>
    <text x="195" y="920" class="flow-label">Services</text>
    
    <rect x="260" y="910" width="15" height="10" class="repository"/>
    <text x="285" y="920" class="flow-label">Repositories</text>
    
    <rect x="360" y="910" width="15" height="10" class="entity"/>
    <text x="385" y="920" class="flow-label">Entities/DTOs</text>
    
    <rect x="70" y="935" width="15" height="10" class="config"/>
    <text x="95" y="945" class="flow-label">Configuration</text>
    
    <rect x="170" y="935" width="15" height="10" class="external"/>
    <text x="195" y="945" class="flow-label">External</text>
    
    <path d="M 260 940 L 280 940" class="dependency-arrow"/>
    <text x="290" y="945" class="flow-label">Dependency</text>
    
    <path d="M 360 940 L 380 940" class="flow-arrow"/>
    <text x="390" y="945" class="flow-label">Data Flow</text>
  </g>
</svg>