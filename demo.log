Starting NatWest Authorization Server Demo...

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::               (v2.7.18)

2025-09-24 15:59:50 [main] INFO  c.n.p.auth.AuthServerDemoApplication - Starting AuthServerDemoApplication v1.0.0-SNAPSHOT using Java 11.0.28 on d06cd10685fd with PID 33608 (/home/ubuntu/spring-auth-demo/target/auth-server-demo-1.0.0-SNAPSHOT.jar started by ubuntu in /home/ubuntu/spring-auth-demo)
2025-09-24 15:59:50 [main] INFO  c.n.p.auth.AuthServerDemoApplication - No active profile set, falling back to 1 default profile: "default"
2025-09-24 15:59:51 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-09-24 15:59:51 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 42 ms. Found 1 JPA repository interfaces.
2025-09-24 15:59:52 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port(s): 9000 (http)
2025-09-24 15:59:52 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-09-24 15:59:52 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/9.0.83]
2025-09-24 15:59:52 [main] INFO  o.a.c.c.C.[.[localhost].[/auth] - Initializing Spring embedded WebApplicationContext
2025-09-24 15:59:52 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1659 ms
2025-09-24 15:59:52 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-09-24 15:59:52 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-09-24 15:59:52 [main] INFO  o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:authdb'
2025-09-24 15:59:52 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-09-24 15:59:52 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 5.6.15.Final
2025-09-24 15:59:53 [main] INFO  o.h.annotations.common.Version - HCANN000001: Hibernate Commons Annotations {5.1.2.Final}
2025-09-24 15:59:53 [main] INFO  org.hibernate.dialect.Dialect - HHH000400: Using dialect: org.hibernate.dialect.H2Dialect
Hibernate: 
    
    drop table if exists oauth2_clients CASCADE 
Hibernate: 
    
    create table oauth2_clients (
       id bigint generated by default as identity,
        access_token_validity_seconds integer,
        client_id varchar(255) not null,
        client_name varchar(255) not null,
        client_secret varchar(255) not null,
        created_at timestamp not null,
        last_used_at timestamp,
        scopes varchar(255),
        status varchar(255) not null,
        tenant_id varchar(255) not null,
        primary key (id)
    )
Hibernate: 
    
    alter table oauth2_clients 
       add constraint UK_prisbq8a2ut7eg0njlyh4heu5 unique (client_id)
2025-09-24 15:59:53 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
2025-09-24 15:59:53 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-09-24 15:59:54 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-09-24 15:59:54 [main] WARN  o.s.b.a.s.s.UserDetailsServiceAutoConfiguration - 

Using generated security password: 8f259acd-188c-4aed-b089-e821d944ce13

This generated password is for development use only. Your security configuration must be updated before running your application in production.

2025-09-24 15:59:55 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-09-24 15:59:55 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port(s): 9000 (http) with context path '/auth'
2025-09-24 15:59:55 [main] INFO  c.n.p.auth.AuthServerDemoApplication - Started AuthServerDemoApplication in 5.287 seconds (JVM running for 5.669)
Hibernate: 
    select
        oauth2clie0_.id as col_0_0_ 
    from
        oauth2_clients oauth2clie0_ 
    where
        oauth2clie0_.client_id=? limit ?
Hibernate: 
    insert 
    into
        oauth2_clients
        (id, access_token_validity_seconds, client_id, client_name, client_secret, created_at, last_used_at, scopes, status, tenant_id) 
    values
        (default, ?, ?, ?, ?, ?, ?, ?, ?, ?)
Created sample client: retail-payment-service (tenant: retail-banking)
Hibernate: 
    select
        oauth2clie0_.id as col_0_0_ 
    from
        oauth2_clients oauth2clie0_ 
    where
        oauth2clie0_.client_id=? limit ?
Hibernate: 
    insert 
    into
        oauth2_clients
        (id, access_token_validity_seconds, client_id, client_name, client_secret, created_at, last_used_at, scopes, status, tenant_id) 
    values
        (default, ?, ?, ?, ?, ?, ?, ?, ?, ?)
Created sample client: corporate-treasury-service (tenant: corporate-banking)
Hibernate: 
    select
        oauth2clie0_.id as col_0_0_ 
    from
        oauth2_clients oauth2clie0_ 
    where
        oauth2clie0_.client_id=? limit ?
Hibernate: 
    insert 
    into
        oauth2_clients
        (id, access_token_validity_seconds, client_id, client_name, client_secret, created_at, last_used_at, scopes, status, tenant_id) 
    values
        (default, ?, ?, ?, ?, ?, ?, ?, ?, ?)
Created sample client: platform-audit-service (tenant: platform)

=== NatWest Authorization Server Demo Started ===
Server URL: http://localhost:9000/auth
Health Check: http://localhost:9000/auth/api/health
API Info: http://localhost:9000/auth/api/info
Clients List: http://localhost:9000/auth/api/clients
H2 Console: http://localhost:9000/auth/h2-console
JWKS Endpoint: http://localhost:9000/auth/.well-known/jwks.json
OAuth2 Discovery: http://localhost:9000/auth/.well-known/oauth-authorization-server

=== Sample Token Request ===
curl -X POST http://localhost:9000/auth/oauth2/token \
  -H 'Content-Type: application/x-www-form-urlencoded' \
  -d 'grant_type=client_credentials&client_id=retail-payment-service&client_secret=payment-secret-2024&scope=read:accounts'
================================================

2025-09-24 16:00:11 [http-nio-9000-exec-1] INFO  o.a.c.c.C.[.[localhost].[/auth] - Initializing Spring DispatcherServlet 'dispatcherServlet'
Hibernate: 
    select
        count(*) as col_0_0_ 
    from
        oauth2_clients oauth2clie0_
Hibernate: 
    insert 
    into
        oauth2_clients
        (id, access_token_validity_seconds, client_id, client_name, client_secret, created_at, last_used_at, scopes, status, tenant_id) 
    values
        (default, ?, ?, ?, ?, ?, ?, ?, ?, ?)
Hibernate: 
    select
        oauth2clie0_.id as id1_0_,
        oauth2clie0_.access_token_validity_seconds as access_t2_0_,
        oauth2clie0_.client_id as client_i3_0_,
        oauth2clie0_.client_name as client_n4_0_,
        oauth2clie0_.client_secret as client_s5_0_,
        oauth2clie0_.created_at as created_6_0_,
        oauth2clie0_.last_used_at as last_use7_0_,
        oauth2clie0_.scopes as scopes8_0_,
        oauth2clie0_.status as status9_0_,
        oauth2clie0_.tenant_id as tenant_10_0_ 
    from
        oauth2_clients oauth2clie0_ 
    where
        oauth2clie0_.client_id=?
Hibernate: 
    update
        oauth2_clients 
    set
        last_used_at=? 
    where
        client_id=?
